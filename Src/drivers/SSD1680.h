// src/drivers/SSD1680.h
#ifndef SSD1680_H
#define SSD1680_H

#include "hal/epd_hal_interface.h"
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>

#define SSD1680_DRIVER_OUTPUT_CONTROL        0x01
#define SSD1680_GATE_DRIVING_VOLTAGE_CONTROL 0x03
    #define SSD1680_GATE_DRIVING_VOLTAGE(V) (((V < 10) ? (0x03) : (V > 20) ? (0x17) : (uint8_t)(((V - 10) / 0.5) + 0x03)))
#define SSD1680_SOURCE_DRIVING_VOLTAGE_CONTROL 0x04
    #define SSD1680_SOURCE_DRIVING_VOLTAGE_VSH(V) (((V < 2.4) ? (0x8E) : (V > 17)  ? (0x4B) : (uint8_t)((V > 8.8) ? (((V - 9) / 0.2) + 0x23) : (((V - 2.4) / 0.1) + 0x8E))))
    #define SSD1680_SOURCE_DRIVING_VOLTAGE_VSL(V) (((V < -17) ? (0x3A) : (V > -5)  ? (0x0A) : (uint8_t)(((-(V) - 5) / 0.25) + 0x0A)))
#define SSD1680_BOOSTER_SOFT_START_CONTROL   0x0C
    #define SSD1680_BOOSTER_SOFT_START_SETTING(DRV_STRENGTH, MIN_TIME) \
        (uint8_t)((((DRV_STRENGTH) & 0x07) << 4) | (((MIN_TIME) & 0x07)))
    #define SSD1680_BOOSTER_SOFT_START_SETTING_TIME_2_6 0x04
    #define SSD1680_BOOSTER_SOFT_START_SETTING_TMIN_TIME_3_2 0x05
    #define SSD1680_BOOSTER_SOFT_START_SETTING_TMIN_TIME_3_9 0x06
    #define SSD1680_BOOSTER_SOFT_START_SETTING_TMIN_TIME_4_6 0x07
    #define SSD1680_BOOSTER_SOFT_START_SETTING_TMIN_TIME_5_4 0x08
    #define SSD1680_BOOSTER_SOFT_START_SETTING_TMIN_TIME_6_3 0x09
    #define SSD1680_BOOSTER_SOFT_START_SETTING_TMIN_TIME_7_3 0x0A
    #define SSD1680_BOOSTER_SOFT_START_SETTING_TMIN_TIME_8_4 0x0B
    #define SSD1680_BOOSTER_SOFT_START_SETTING_TMIN_TIME_9_8 0x0C
    #define SSD1680_BOOSTER_SOFT_START_SETTING_TMIN_TIME_11_5 0x0D
    #define SSD1680_BOOSTER_SOFT_START_SETTING_TMIN_TIME_13_8 0x0E
    #define SSD1680_BOOSTER_SOFT_START_SETTING_TMIN_TIME_16_5 0x0F
    #define SSD1680_BOOSTER_SOFT_START_SETTING_DURATION(DURATION_MS1, DURATION_MS2, DURATION_MS3) \
        (uint8_t)((((DURATION_MS1) & 0x03) << 4) | (((DURATION_MS2) & 0x03) << 2) | (((DURATION_MS3) & 0x03)))
#define SSD1680_DEEP_SLEEP_MODE               0x10
#define SSD1680_DATA_ENTRY_MODE_SETTING      0x11
    #define SSD1680_DATA_ENTRY_MODE_X_INCREMENT        0x01
    #define SSD1680_DATA_ENTRY_MODE_Y_INCREMENT        0x02
    #define SSD1680_DATA_ENTRY_MODE_X_DECREMENT        0x00
    #define SSD1680_DATA_ENTRY_MODE_Y_DECREMENT        0x00
    #define SSD1680_DATA_ENTRY_MODE_XY_INCREMENT       (SSD1680_DATA_ENTRY_MODE_X_INCREMENT | SSD1680_DATA_ENTRY_MODE_Y_INCREMENT)
    #define SSD1680_DATA_ENTRY_MODE_X_DECREMENT_Y_INCREMENT (SSD1680_DATA_ENTRY_MODE_X_DECREMENT | SSD1680_DATA_ENTRY_MODE_Y_INCREMENT)
    #define SSD1680_DATA_ENTRY_MODE_X_INCREMENT_Y_DECREMENT (SSD1680_DATA_ENTRY_MODE_X_INCREMENT | SSD1680_DATA_ENTRY_MODE_Y_DECREMENT)
    #define SSD1680_DATA_ENTRY_MODE_XY_DECREMENT       (SSD1680_DATA_ENTRY_MODE_X_DECREMENT | SSD1680_DATA_ENTRY_MODE_Y_DECREMENT)
#define SSD1680_SW_RESET                     0x12
#define SSD1680_MASTER_ACTIVATION            0x20
#define SSD1680_DISPLAY_UPDATE_CONTROL_1     0x21
#define SSD1680_DISPLAY_UPDATE_CONTROL_2     0x22
    #define SSD1680_DISPLAY_UPDATE_MODE_CUSTOM_LUT    0xC7
    #define SSD1680_DISPLAY_UPDATE_MODE_DEFAULT_LUT   0xF4
#define SSD1680_WRITE_RAM1                      0x24
#define SSD1680_WRITE_RAM2                      0x26
#define SSD1680_WRITE_REGISTER_VCOM_CONTROL     0x2B
#define SSD1680_WRITE_VCOM_REGISTER             0x2C
#define SSD1680_WRITE_LUT_REGISTER              0x32
#define SSD1680_BORDER_WAVEFORM_CONTROL         0x3C
#define SSD1680_SET_RAM_X_ADDRESS_START_END    0x44
#define SSD1680_SET_RAM_Y_ADDRESS_START_END    0x45
#define SSD1680_SET_RAM_X_ADDRESS_COUNTER      0x4E
#define SSD1680_SET_RAM_Y_ADDRESS_COUNTER      0x4F

typedef enum {
    SSD1680_LUT_VOLTAGE_VSS = 0b00,
    SSD1680_LUT_VOLTAGE_VSH1 = 0b01,
    SSD1680_LUT_VOLTAGE_VSL = 0b10,
    SSD1680_LUT_VOLTAGE_VSH2 = 0b11,
} SSD1680_LUT_VOLTAGE_t;

typedef struct lut_group{
    SSD1680_LUT_VOLTAGE_t LUT[5][4];

    uint8_t continus_time[4];
    uint8_t repeat_time_AB;
    uint8_t repeat_time_CD;
    uint8_t repeat_time_group;
    uint8_t xon_AB;
    uint8_t xon_CD;
    uint8_t FR;
} lut_group_t;

typedef struct lut{
    lut_group_t wave[12];
    uint8_t VGH;
    uint8_t VSH1;
    uint8_t VSH2;
    uint8_t VSL;
    uint8_t VCOM;
} lut_t;

#endif // SSD1680_H